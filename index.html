<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PartexChat</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0e0e0e, #1a1a1a);
      color: white;
      height: 100vh;
      overflow: hidden;
    }

    /* Login/Register Screen */
    #authSection {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #0e0e0e, #2d2d2d);
    }

    .auth-container {
      background: #1a1a1a;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      width: 100%;
      max-width: 400px;
      border: 1px solid #333;
    }

    .auth-container h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #2ecc71;
      font-size: 28px;
    }

    .auth-input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
      font-size: 16px;
    }

    .auth-input:focus {
      border-color: #2ecc71;
      outline: none;
    }

    .auth-button {
      width: 100%;
      padding: 15px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 20px 0 10px;
      transition: background 0.3s;
    }

    .auth-button:hover {
      background: #27ae60;
    }

    .auth-toggle {
      text-align: center;
      margin-top: 20px;
    }

    .auth-toggle a {
      color: #2ecc71;
      text-decoration: none;
      cursor: pointer;
    }

    .auth-toggle a:hover {
      text-decoration: underline;
    }

    .error-message {
      color: #e74c3c;
      text-align: center;
      margin: 10px 0;
      padding: 10px;
      background: rgba(231, 76, 60, 0.1);
      border-radius: 5px;
      display: none;
    }

    /* Main App */
    #mainApp {
      display: none;
      height: 100vh;
      flex-direction: column;
    }

    header {
      background: #111;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #2ecc71;
    }

    header h1 {
      color: #2ecc71;
      font-size: 24px;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #2ecc71;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }

    .user-details {
      display: flex;
      flex-direction: column;
    }

    .username {
      font-weight: bold;
      color: #2ecc71;
    }

    .user-email {
      color: #ccc;
      font-size: 12px;
    }

    .partex-plus-badge {
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: bold;
      margin-left: 5px;
    }

    .nav-button {
      background: #2ecc71;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .nav-button:hover {
      background: #27ae60;
    }

    .main-content {
      display: flex;
      flex: 1;
      height: calc(100vh - 70px);
    }

    /* Servers Sidebar */
    .servers-sidebar {
      width: 80px;
      background: #151515;
      border-right: 1px solid #333;
      padding: 15px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      overflow-y: auto;
    }

    .server-icon {
      width: 50px;
      height: 50px;
      background: #2ecc71;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      transition: all 0.3s;
      border: 2px solid transparent;
      position: relative;
    }

    .server-icon:hover {
      transform: scale(1.1);
      border-color: #2ecc71;
    }

    .server-icon.active {
      border-color: #2ecc71;
      transform: scale(1.1);
    }

    .server-icon.dm {
      background: #3498db;
    }

    .server-icon.boosted {
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
    }

    .add-server {
      background: #333;
      color: #2ecc71;
      font-size: 24px;
    }

    /* Channels Sidebar */
    .channels-sidebar {
      width: 250px;
      background: #1a1a1a;
      border-right: 1px solid #333;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .server-header {
      color: #2ecc71;
      font-size: 18px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .server-actions {
      display: flex;
      gap: 5px;
    }

    .server-action-btn {
      background: #333;
      color: #2ecc71;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .server-action-btn:hover {
      background: #444;
    }

    .channels-container {
      flex: 1;
      overflow-y: auto;
    }

    .channels-list {
      list-style: none;
      margin-bottom: 20px;
    }

    .channel-item {
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
      color: #ccc;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .channel-item:hover {
      background: #222;
      color: white;
    }

    .channel-item.active {
      background: #2ecc71;
      color: white;
    }

    .channel-item.welcome {
      color: #ffa726;
    }

    .create-channel-btn {
      width: 100%;
      padding: 10px;
      background: #333;
      color: #2ecc71;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .create-channel-btn:hover {
      background: #444;
    }

    /* Friends Section */
    .friends-section {
      margin-top: 20px;
    }

    .friends-header {
      color: #3498db;
      font-size: 16px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .friend-item {
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
      color: #ccc;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .friend-item:hover {
      background: #222;
      color: white;
    }

    .friend-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #3498db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    /* Members Sidebar */
    .members-sidebar {
      width: 200px;
      background: #151515;
      border-left: 1px solid #333;
      padding: 20px;
      overflow-y: auto;
    }

    .members-header {
      color: #2ecc71;
      font-size: 16px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }

    .member-item {
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .member-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #2ecc71;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .member-name {
      color: #ccc;
      font-size: 14px;
    }

    .online-indicator {
      width: 8px;
      height: 8px;
      background: #2ecc71;
      border-radius: 50%;
      margin-left: auto;
    }

    /* Chat Area */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #1a1a1a;
    }

    .chat-header {
      background: #151515;
      padding: 15px 20px;
      border-bottom: 1px solid #333;
      color: #2ecc71;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .messages-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #151515;
    }

    .welcome-message {
      background: linear-gradient(45deg, #2ecc71, #3498db);
      padding: 20px;
      border-radius: 10px;
      margin: 15px 0;
      text-align: center;
      border: 2px solid #2ecc71;
    }

    .welcome-message h3 {
      margin-bottom: 10px;
      color: white;
    }

    .message {
      margin: 15px 0;
      padding: 10px;
      background: #222;
      border-radius: 8px;
      border-left: 3px solid #2ecc71;
    }

    .message.dm {
      border-left-color: #3498db;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #2ecc71;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }

    .message.dm .message-avatar {
      background: #3498db;
    }

    .message-sender {
      color: #2ecc71;
      font-weight: bold;
    }

    .message.dm .message-sender {
      color: #3498db;
    }

    .message-timestamp {
      color: #888;
      font-size: 12px;
    }

    .message-content {
      margin-left: 42px;
    }

    .message-input-container {
      padding: 20px;
      background: #151515;
      border-top: 1px solid #333;
    }

    .message-input-wrapper {
      display: flex;
      gap: 10px;
    }

    #messageInput {
      flex: 1;
      padding: 12px;
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
      font-size: 14px;
    }

    #messageInput:focus {
      border-color: #2ecc71;
      outline: none;
    }

    .send-button {
      padding: 12px 20px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .send-button:hover {
      background: #27ae60;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #1a1a1a;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #333;
    }

    .modal h3 {
      color: #2ecc71;
      margin-bottom: 20px;
      text-align: center;
    }

    .modal-input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .modal-btn.primary {
      background: #2ecc71;
      color: white;
    }

    .modal-btn.secondary {
      background: #333;
      color: white;
    }

    /* Server Settings */
    .settings-section {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .settings-section h4 {
      color: #2ecc71;
      margin-bottom: 10px;
    }

    .boost-section {
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
    }

    .boost-btn {
      background: white;
      color: #ff6b6b;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }

    .boost-btn:hover {
      background: #f0f0f0;
    }

    /* Invite Modal */
    .invite-link {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      word-break: break-all;
      font-family: monospace;
      border: 1px solid #333;
    }

    .copy-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .copy-btn:hover {
      background: #2980b9;
    }

    /* Profile Modal */
    .profile-modal {
      max-width: 500px;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #2ecc71;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
    }

    .profile-details {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .profile-detail {
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
    }

    .profile-detail label {
      color: #ccc;
    }

    .profile-detail span {
      color: #2ecc71;
      font-weight: bold;
    }

    /* PartexPlus Features */
    .partex-features {
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .partex-features h4 {
      text-align: center;
      margin-bottom: 10px;
      color: white;
    }

    .feature-list {
      list-style: none;
    }

    .feature-list li {
      margin: 5px 0;
      color: white;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- Login/Register Screen -->
  <div id="authSection">
    <div class="auth-container">
      <div id="loginDiv">
        <h2>Login zu PartexChat</h2>
        <div id="loginError" class="error-message"></div>
        <input type="email" id="loginEmail" class="auth-input" placeholder="Deine Email">
        <input type="password" id="loginPassword" class="auth-input" placeholder="Dein Passwort">
        <button class="auth-button" onclick="login()">Jetzt Einloggen</button>
        <div class="auth-toggle">
          <p>Noch keinen Account? <a onclick="toggleAuth()">Hier registrieren</a></p>
        </div>
      </div>

      <div id="registerDiv" style="display:none;">
        <h2>Account erstellen</h2>
        <div id="registerError" class="error-message"></div>
        <input type="text" id="registerUsername" class="auth-input" placeholder="Username">
        <input type="email" id="registerEmail" class="auth-input" placeholder="Email">
        <input type="password" id="registerPassword" class="auth-input" placeholder="Passwort">
        <button class="auth-button" onclick="register()">Account erstellen</button>
        <div class="auth-toggle">
          <p>Bereits Account? <a onclick="toggleAuth()">Zum Login</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp">
    <header>
      <h1>PartexChat</h1>
      <div class="user-menu">
        <div class="user-info" onclick="showProfileModal()" style="cursor: pointer;">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <div class="username" id="userUsername">Username</div>
            <div class="user-email" id="userEmail">user@example.com</div>
          </div>
        </div>
        <button class="nav-button" onclick="showProfileModal()">Profil</button>
      </div>
    </header>

    <div class="main-content">
      <!-- Servers Sidebar -->
      <div class="servers-sidebar" id="serversSidebar">
        <div class="server-icon active" onclick="selectServer('global')">üåç</div>
        <div class="server-icon dm" onclick="selectServer('dms')">üí¨</div>
        <div class="server-icon add-server" onclick="showCreateServerModal()">+</div>
        <!-- Servers will be added here dynamically -->
      </div>

      <!-- Channels Sidebar -->
      <div class="channels-sidebar" id="channelsSidebar">
        <div class="server-header" id="serverName">
          <span>Global Server</span>
          <div class="server-actions" id="serverActions" style="display: none;">
            <button class="server-action-btn" onclick="showInviteModal()" title="Einladen">üì®</button>
            <button class="server-action-btn" onclick="showServerSettings()" title="Einstellungen">‚öôÔ∏è</button>
          </div>
        </div>
        
        <div class="channels-container">
          <!-- Channels for servers -->
          <ul class="channels-list" id="channelsList">
            <li class="channel-item welcome active" onclick="selectChannel('willkommen')">üéâ Willkommen</li>
            <li class="channel-item" onclick="selectChannel('general')">üí¨ Allgemein</li>
            <li class="channel-item" onclick="selectChannel('games')">üéÆ Gaming</li>
            <li class="channel-item" onclick="selectChannel('music')">üéµ Musik</li>
          </ul>

          <!-- Friends list for DMs -->
          <div class="friends-section" id="friendsSection" style="display: none;">
            <div class="friends-header">
              <span>DIRECT MESSAGES</span>
              <button class="create-channel-btn" onclick="showAddFriendModal()" style="padding: 5px 10px; font-size: 12px;">Freund hinzuf√ºgen</button>
            </div>
            <div id="friendsList">
              <!-- Friends will be added here -->
            </div>
          </div>
        </div>

        <button class="create-channel-btn" onclick="showCreateChannelModal()" id="createChannelBtn">+ Channel erstellen</button>
      </div>

      <!-- Chat Area -->
      <div class="chat-area">
        <div class="chat-header" id="chatHeader">
          # üéâ Willkommen
        </div>
        <div class="messages-container" id="messagesContainer">
          <!-- Messages will appear here -->
        </div>
        <div class="message-input-container">
          <div class="message-input-wrapper">
            <input type="text" id="messageInput" placeholder="Schreibe eine Nachricht in #willkommen..." onkeypress="handleKeyPress(event)">
            <button class="send-button" onclick="sendMessage()">Senden</button>
          </div>
        </div>
      </div>

      <!-- Members Sidebar -->
      <div class="members-sidebar" id="membersSidebar">
        <div class="members-header">MITGLIEDER - <span id="membersCount">0</span></div>
        <div id="membersList">
          <!-- Members will be added here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal" id="createServerModal">
    <div class="modal-content">
      <h3>üöÄ Server erstellen</h3>
      <input type="text" id="serverNameInput" class="modal-input" placeholder="Server Name">
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideCreateServerModal()">Abbrechen</button>
        <button class="modal-btn primary" onclick="createServer()">Erstellen</button>
      </div>
    </div>
  </div>

  <div class="modal" id="createChannelModal">
    <div class="modal-content">
      <h3>üîä Channel erstellen</h3>
      <input type="text" id="channelNameInput" class="modal-input" placeholder="Channel Name">
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideCreateChannelModal()">Abbrechen</button>
        <button class="modal-btn primary" onclick="createChannel()">Erstellen</button>
      </div>
    </div>
  </div>

  <div class="modal" id="addFriendModal">
    <div class="modal-content">
      <h3>üë• Freund hinzuf√ºgen</h3>
      <input type="text" id="friendUsernameInput" class="modal-input" placeholder="Username des Freundes">
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideAddFriendModal()">Abbrechen</button>
        <button class="modal-btn primary" onclick="addFriend()">Hinzuf√ºgen</button>
      </div>
    </div>
  </div>

  <div class="modal" id="inviteModal">
    <div class="modal-content">
      <h3>üì® Server Einladung</h3>
      <p>Teile diesen Link um Leute einzuladen:</p>
      <div class="invite-link" id="inviteLink">Lade Einladung...</div>
      <button class="copy-btn" onclick="copyInviteLink()">Link kopieren</button>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideInviteModal()">Schlie√üen</button>
      </div>
    </div>
  </div>

  <div class="modal" id="serverSettingsModal">
    <div class="modal-content">
      <h3>‚öôÔ∏è Server Einstellungen</h3>
      <div class="settings-section">
        <h4>Allgemein</h4>
        <p><strong>Server Name:</strong> <span id="settingsServerName">Loading...</span></p>
        <p><strong>Besitzer:</strong> <span id="settingsServerOwner">Loading...</span></p>
        <p><strong>Mitglieder:</strong> <span id="settingsMemberCount">0</span></p>
      </div>

      <div class="boost-section">
        <h4>üöÄ Server Boost</h4>
        <p>Booste diesen Server f√ºr exklusive Features!</p>
        <p><strong>Aktuelle Boosts:</strong> <span id="currentBoosts">0</span></p>
        <button class="boost-btn" onclick="boostServer()" id="boostBtn">üîÆ Server Boosten (2‚Ç¨/Monat)</button>
        <p style="font-size: 12px; margin-top: 10px;">Ben√∂tigt PartexPlus</p>
      </div>

      <div class="settings-section">
        <h4>Channel Verwalten</h4>
        <button class="modal-btn secondary" onclick="showCreateChannelModal(); hideServerSettingsModal();" style="width: 100%; margin: 5px 0;">+ Channel erstellen</button>
      </div>

      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideServerSettingsModal()">Schlie√üen</button>
      </div>
    </div>
  </div>

  <div class="modal" id="profileModal">
    <div class="modal-content profile-modal">
      <h3>üë§ Dein Profil</h3>
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">U</div>
        <h4 id="profileUsername">Username</h4>
        <div id="profilePartexPlus"></div>
      </div>
      
      <div class="profile-details">
        <div class="profile-detail">
          <label>Email:</label>
          <span id="profileEmail">user@example.com</span>
        </div>
        <div class="profile-detail">
          <label>Mitglied seit:</label>
          <span id="profileCreatedAt">-</span>
        </div>
        <div class="profile-detail">
          <label>User ID:</label>
          <span id="profileUserId">-</span>
        </div>
      </div>

      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="hideProfileModal()">Schlie√üen</button>
        <button class="modal-btn primary" onclick="logout()" style="background: #e74c3c;">üö™ Ausloggen</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, push, onChildAdded, set, onValue, get, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBWxwGrVmF2IQEGIyEZCtwp9vsRdpGAnRs",
      authDomain: "partexchat.firebaseapp.com",
      databaseURL: "https://partexchat-default-rtdb.firebaseio.com",
      projectId: "partexchat",
      storageBucket: "partexchat.firebasestorage.app",
      messagingSenderId: "348087049579",
      appId: "1:348087049579:web:a61c4aef9e7272505d802e",
      measurementId: "G-KY5XWKYY0D"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Global Variables
    let currentServer = 'global';
    let currentChannel = 'willkommen';
    let currentDM = null;
    let servers = {};
    let friends = {};
    let messageListener = null;
    let currentUserData = null;
    let onlineUsers = {};

    console.log("Firebase initialized");

    // Auth Toggle
    window.toggleAuth = function() {
      const loginDiv = document.getElementById('loginDiv');
      const registerDiv = document.getElementById('registerDiv');
      loginDiv.style.display = loginDiv.style.display === 'none' ? 'block' : 'none';
      registerDiv.style.display = registerDiv.style.display === 'none' ? 'block' : 'none';
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('registerError').style.display = 'none';
    }

    // Show Error
    function showError(type, message) {
      const errorDiv = document.getElementById(type + 'Error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    // Register
    window.register = async function() {
      const username = document.getElementById('registerUsername').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      
      if (!username || !email || !password) {
        showError('register', "Bro, vergiss nicht Username, Email und Passwort! üö®");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        console.log("User registered:", userCredential.user);
        
        // User in Database speichern mit Username
        const userRef = ref(db, 'users/' + userCredential.user.uid);
        await set(userRef, {
          username: username,
          email: email,
          avatar: username.charAt(0).toUpperCase(),
          createdAt: new Date().toISOString(),
          hasPartexPlus: email === 'memberfarm3@gmail.com', // PartexPlus f√ºr deine Email
          isOnline: true,
          lastSeen: new Date().toISOString()
        });

        // Username auch in usernames index speichern
        const usernameRef = ref(db, 'usernames/' + username.toLowerCase());
        await set(usernameRef, userCredential.user.uid);

        // Welcome message in global server
        const welcomeMessageRef = ref(db, 'servers/global/channels/willkommen/messages');
        await push(welcomeMessageRef, {
          text: `üéâ Willkommen ${username} im PartexChat! Viel Spa√ü beim Chatten!`,
          sender: 'System',
          senderId: 'system',
          senderAvatar: 'ü§ñ',
          timestamp: new Date().toISOString(),
          isSystem: true
        });
        
        alert("Geil! Account erstellt! üéâ");
      } catch (error) {
        console.error("Registration error:", error);
        showError('register', "Fehler: " + error.message);
      }
    }

    // Login
    window.login = async function() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        showError('login', "Bro, Email und Passwort nicht vergessen! üö®");
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        console.log("Login successful");
      } catch (error) {
        console.error("Login error:", error);
        showError('login', "Login fehlgeschlagen: " + error.message);
      }
    }

    // Logout
    window.logout = function() {
      // Set user offline
      if (auth.currentUser) {
        const userRef = ref(db, 'users/' + auth.currentUser.uid);
        update(userRef, {
          isOnline: false,
          lastSeen: new Date().toISOString()
        });
      }

      signOut(auth).then(() => {
        alert("Bis bald! üëã");
      }).catch((error) => {
        console.error("Logout error:", error);
      });
    }

    // Auth State
    onAuthStateChanged(auth, (user) => {
      console.log("Auth state changed:", user);
      if (user) {
        // Set user online
        const userRef = ref(db, 'users/' + user.uid);
        update(userRef, {
          isOnline: true,
          lastSeen: new Date().toISOString()
        });

        document.getElementById('authSection').style.display = 'none';
        document.getElementById('mainApp').style.display = 'flex';
        loadUserProfile(user.uid);
        loadServers();
        loadFriends();
        loadOnlineUsers();
      } else {
        document.getElementById('authSection').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
      }
    });

    // Load User Profile
    function loadUserProfile(userId) {
      const userRef = ref(db, 'users/' + userId);
      onValue(userRef, (snapshot) => {
        const userData = snapshot.val();
        if (userData) {
          currentUserData = userData;
          
          // Update UI
          document.getElementById('userUsername').textContent = userData.username;
          document.getElementById('userEmail').textContent = userData.email;
          document.getElementById('userAvatar').textContent = userData.avatar;
          
          // Update profile modal
          document.getElementById('profileUsername').textContent = userData.username;
          document.getElementById('profileEmail').textContent = userData.email;
          document.getElementById('profileAvatar').textContent = userData.avatar;
          document.getElementById('profileUserId').textContent = userId;
          document.getElementById('profileCreatedAt').textContent = new Date(userData.createdAt).toLocaleDateString('de-DE');
          
          // PartexPlus Badge
          const partexPlusBadge = document.getElementById('profilePartexPlus');
          if (userData.hasPartexPlus) {
            partexPlusBadge.innerHTML = '<div class="partex-plus-badge">PARTEX PLUS üî•</div>';
            
            // Add PartexPlus features to modal
            const featuresHTML = `
              <div class="partex-features">
                <h4>üéâ PartexPlus Features</h4>
                <ul class="feature-list">
                  <li>‚úÖ Gr√∂√üere Datei-Uploads</li>
                  <li>‚úÖ HD Video Streaming</li>
                  <li>‚úÖ Spezielle Emojis</li>
                  <li>‚úÖ Server Boosts</li>
                  <li>‚úÖ Premium Support</li>
                </ul>
              </div>
            `;
            partexPlusBadge.insertAdjacentHTML('afterend', featuresHTML);
          } else {
            partexPlusBadge.innerHTML = '';
          }
        }
      });
    }

    // Send Message - FIXED VERSION
    window.sendMessage = async function() {
      const user = auth.currentUser;
      if (!user) {
        alert("Bitte erst einloggen!");
        return;
      }

      const msg = document.getElementById('messageInput').value;
      if (msg.trim() === "") return;

      try {
        // Use cached user data to avoid undefined errors
        if (!currentUserData) {
          alert("User Daten werden noch geladen...");
          return;
        }

        let messageRef;
        
        if (currentServer === 'dms' && currentDM) {
          // DM Nachricht
          const dmId = [user.uid, currentDM].sort().join('_');
          messageRef = ref(db, `dms/${dmId}/messages`);
        } else {
          // Server Nachricht - KORRIGIERTER PATH
          messageRef = ref(db, `servers/${currentServer}/channels/${currentChannel}/messages`);
        }

        // VALIDIERTE Nachrichtendaten
        const messageData = {
          text: msg,
          sender: currentUserData.username || 'Unbekannt',
          senderId: user.uid,
          senderAvatar: currentUserData.avatar || '?',
          timestamp: new Date().toISOString()
        };

        console.log("Sending message to:", messageRef.toString());
        console.log("Message data:", messageData);

        // VALIDATION: Check if all required fields are present
        if (!messageData.sender || !messageData.senderId) {
          throw new Error("User data is incomplete");
        }

        await push(messageRef, messageData);
        
        document.getElementById('messageInput').value = "";
      } catch (error) {
        console.error("Error sending message:", error);
        alert("Fehler beim Senden der Nachricht: " + error.message);
      }
    }

    // Load Messages - FIXED VERSION
    function loadMessages() {
      const messagesContainer = document.getElementById('messagesContainer');
      messagesContainer.innerHTML = '';

      // Remove previous listener to prevent duplicates
      if (messageListener) {
        messageListener();
      }

      let messagesRef;
      
      if (currentServer === 'dms' && currentDM) {
        // DM Nachrichten
        const dmId = [auth.currentUser.uid, currentDM].sort().join('_');
        messagesRef = ref(db, `dms/${dmId}/messages`);
      } else {
        // Server Nachrichten - KORRIGIERTER PATH
        messagesRef = ref(db, `servers/${currentServer}/channels/${currentChannel}/messages`);
      }

      console.log("Loading messages from:", messagesRef.toString());

      messageListener = onChildAdded(messagesRef, (snapshot) => {
        const msg = snapshot.val();
        
        // Check if message data is valid
        if (!msg) {
          console.warn("Invalid message data:", msg);
          return;
        }

        const messageDiv = document.createElement("div");
        
        if (msg.isSystem) {
          messageDiv.className = "welcome-message";
          messageDiv.innerHTML = `
            <h3>${msg.text}</h3>
            <p>Willkommen in unserer Community! üéâ</p>
          `;
        } else {
          messageDiv.className = currentServer === 'dms' ? "message dm" : "message";
          
          const time = new Date(msg.timestamp).toLocaleTimeString('de-DE', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          
          messageDiv.innerHTML = `
            <div class="message-header">
              <div class="message-avatar">${msg.senderAvatar || '?'}</div>
              <div class="message-sender">${msg.sender || 'Unbekannt'}</div>
              <div class="message-timestamp">${time}</div>
            </div>
            <div class="message-content">${msg.text}</div>
          `;
        }
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, (error) => {
        console.error("Error loading messages:", error);
      });
    }

    // Enter Key
    window.handleKeyPress = function(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }

    // Server Functions
    window.selectServer = function(serverId) {
      currentServer = serverId;
      currentDM = null;
      
      // Update UI
      document.querySelectorAll('.server-icon').forEach(icon => {
        icon.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update server name and show/hide sections
      const channelsList = document.getElementById('channelsList');
      const friendsSection = document.getElementById('friendsSection');
      const createChannelBtn = document.getElementById('createChannelBtn');
      const serverActions = document.getElementById('serverActions');
      const membersSidebar = document.getElementById('membersSidebar');
      
      if (serverId === 'dms') {
        document.getElementById('serverName').innerHTML = '<span>Direct Messages</span>';
        channelsList.style.display = 'none';
        friendsSection.style.display = 'block';
        createChannelBtn.style.display = 'none';
        serverActions.style.display = 'none';
        membersSidebar.style.display = 'none';
        document.getElementById('chatHeader').textContent = 'W√§hle einen Freund f√ºr DM';
        document.getElementById('messageInput').placeholder = 'W√§hle einen Freund zum Schreiben...';
        document.getElementById('messageInput').disabled = true;
      } else {
        const serverName = serverId === 'global' ? 'Global Server' : servers[serverId]?.name || 'Unbekannt';
        document.getElementById('serverName').innerHTML = `
          <span>${serverName}</span>
          <div class="server-actions">
            <button class="server-action-btn" onclick="showInviteModal()" title="Einladen">üì®</button>
            <button class="server-action-btn" onclick="showServerSettings()" title="Einstellungen">‚öôÔ∏è</button>
          </div>
        `;
        channelsList.style.display = 'block';
        friendsSection.style.display = 'none';
        createChannelBtn.style.display = 'block';
        serverActions.style.display = 'flex';
        membersSidebar.style.display = 'block';
        document.getElementById('messageInput').disabled = false;
        selectChannel('willkommen');
      }
      
      loadMessages();
      loadServerMembers();
    }

    window.selectChannel = function(channelId) {
      currentChannel = channelId;
      currentDM = null;
      
      // Update UI
      document.querySelectorAll('.channel-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update chat header
      const channelName = getChannelName(channelId);
      document.getElementById('chatHeader').textContent = `# ${channelName}`;
      document.getElementById('messageInput').placeholder = `Schreibe eine Nachricht in #${channelName}...`;
      
      loadMessages();
    }

    function getChannelName(channelId) {
      const channelNames = {
        'willkommen': 'üéâ Willkommen',
        'general': 'üí¨ Allgemein',
        'games': 'üéÆ Gaming',
        'music': 'üéµ Musik'
      };
      return channelNames[channelId] || channelId;
    }

    // Start DM with friend
    function startDM(friendId) {
      currentDM = friendId;
      const friend = friends[friendId];
      if (friend) {
        document.getElementById('chatHeader').textContent = `üí¨ ${friend.username}`;
        document.getElementById('messageInput').placeholder = `Schreibe eine Nachricht an ${friend.username}...`;
        document.getElementById('messageInput').disabled = false;
        loadMessages();
      }
    }

    // Modal Functions
    window.showCreateServerModal = function() {
      document.getElementById('createServerModal').style.display = 'flex';
    }

    window.hideCreateServerModal = function() {
      document.getElementById('createServerModal').style.display = 'none';
      document.getElementById('serverNameInput').value = '';
    }

    window.showCreateChannelModal = function() {
      document.getElementById('createChannelModal').style.display = 'flex';
    }

    window.hideCreateChannelModal = function() {
      document.getElementById('createChannelModal').style.display = 'none';
      document.getElementById('channelNameInput').value = '';
    }

    window.showAddFriendModal = function() {
      document.getElementById('addFriendModal').style.display = 'flex';
    }

    window.hideAddFriendModal = function() {
      document.getElementById('addFriendModal').style.display = 'none';
      document.getElementById('friendUsernameInput').value = '';
    }

    window.showInviteModal = function() {
      document.getElementById('inviteModal').style.display = 'flex';
      generateInviteLink();
    }

    window.hideInviteModal = function() {
      document.getElementById('inviteModal').style.display = 'none';
    }

    window.showServerSettings = function() {
      document.getElementById('serverSettingsModal').style.display = 'flex';
      loadServerSettings();
    }

    window.hideServerSettingsModal = function() {
      document.getElementById('serverSettingsModal').style.display = 'none';
    }

    window.showProfileModal = function() {
      document.getElementById('profileModal').style.display = 'flex';
    }

    window.hideProfileModal = function() {
      document.getElementById('profileModal').style.display = 'none';
    }

    // Generate Invite Link
    function generateInviteLink() {
      const inviteCode = Math.random().toString(36).substring(2, 10).toUpperCase();
      const inviteLink = `https://partexchat.netlify.app/?invite=${currentServer}&code=${inviteCode}`;
      
      // Save invite to database
      const inviteRef = ref(db, `servers/${currentServer}/invites/${inviteCode}`);
      set(inviteRef, {
        createdBy: auth.currentUser.uid,
        createdAt: new Date().toISOString(),
        uses: 0,
        maxUses: 10
      });
      
      document.getElementById('inviteLink').textContent = inviteLink;
    }

    // Copy Invite Link
    window.copyInviteLink = function() {
      const inviteLink = document.getElementById('inviteLink').textContent;
      navigator.clipboard.writeText(inviteLink).then(() => {
        alert("Einladungslink kopiert! üìã");
      });
    }

    // Load Server Settings
    function loadServerSettings() {
      const server = servers[currentServer];
      if (server) {
        document.getElementById('settingsServerName').textContent = server.name;
        document.getElementById('settingsMemberCount').textContent = Object.keys(onlineUsers).length;
        
        // Get owner username
        const ownerRef = ref(db, 'users/' + server.owner);
        get(ownerRef).then((snapshot) => {
          const ownerData = snapshot.val();
          if (ownerData) {
            document.getElementById('settingsServerOwner').textContent = ownerData.username;
          }
        });

        // Load boost info
        const boosts = server.boosts || 0;
        document.getElementById('currentBoosts').textContent = boosts;
        
        // Update boost button
        const boostBtn = document.getElementById('boostBtn');
        if (currentUserData && currentUserData.hasPartexPlus) {
          boostBtn.disabled = false;
          boostBtn.textContent = `üîÆ Server Boosten (${boosts + 1}‚Ç¨/Monat)`;
        } else {
          boostBtn.disabled = true;
          boostBtn.textContent = "üîÆ PartexPlus ben√∂tigt";
        }
      }
    }

    // Boost Server
    window.boostServer = function() {
      if (!currentUserData || !currentUserData.hasPartexPlus) {
        alert("Du ben√∂tigst PartexPlus um Server zu boosten! üîÆ");
        return;
      }

      const serverRef = ref(db, `servers/${currentServer}`);
      get(serverRef).then((snapshot) => {
        const server = snapshot.val();
        const currentBoosts = server.boosts || 0;
        
        update(serverRef, {
          boosts: currentBoosts + 1,
          boostedBy: auth.currentUser.uid,
          lastBoosted: new Date().toISOString()
        });

        // Update server icon
        const serverIcons = document.querySelectorAll('.server-icon');
        serverIcons.forEach(icon => {
          if (icon.onclick && icon.onclick.toString().includes(currentServer)) {
            icon.classList.add('boosted');
          }
        });

        alert(`üéâ Server geboostet! Du hast ${currentBoosts + 1} Boost(s) aktiviert!`);
        hideServerSettingsModal();
      });
    }

    // Load Online Users
    function loadOnlineUsers() {
      const usersRef = ref(db, 'users');
      onValue(usersRef, (snapshot) => {
        const users = snapshot.val();
        onlineUsers = {};
        
        if (users) {
          Object.keys(users).forEach(userId => {
            if (users[userId].isOnline) {
              onlineUsers[userId] = users[userId];
            }
          });
        }
        
        loadServerMembers();
      });
    }

    // Load Server Members
    function loadServerMembers() {
      const membersList = document.getElementById('membersList');
      const membersCount = document.getElementById('membersCount');
      membersList.innerHTML = '';

      let memberCount = 0;
      
      Object.keys(onlineUsers).forEach(userId => {
        const user = onlineUsers[userId];
        if (user) {
          memberCount++;
          const memberItem = document.createElement('div');
          memberItem.className = 'member-item';
          memberItem.innerHTML = `
            <div class="member-avatar">${user.avatar}</div>
            <div class="member-name">${user.username}</div>
            <div class="online-indicator"></div>
          `;
          membersList.appendChild(memberItem);
        }
      });

      membersCount.textContent = memberCount;
    }

    // Create Server
    window.createServer = async function() {
      const serverName = document.getElementById('serverNameInput').value;
      if (!serverName) {
        alert("Gib einen Server-Namen ein!");
        return;
      }

      const user = auth.currentUser;
      if (!user) return;

      try {
        const serverRef = ref(db, 'servers');
        const newServerRef = push(serverRef);
        const serverId = newServerRef.key;

        await set(newServerRef, {
          name: serverName,
          owner: user.uid,
          createdAt: new Date().toISOString(),
          channels: {
            willkommen: {
              name: "üéâ Willkommen",
              createdBy: user.uid
            },
            general: {
              name: "üí¨ Allgemein",
              createdBy: user.uid
            }
          }
        });

        // Welcome message
        const welcomeMessageRef = ref(db, `servers/${serverId}/channels/willkommen/messages`);
        await push(welcomeMessageRef, {
          text: `üéâ Willkommen im ${serverName} Server!`,
          sender: 'System',
          senderId: 'system',
          senderAvatar: 'ü§ñ',
          timestamp: new Date().toISOString(),
          isSystem: true
        });

        addServerToUI(serverId, serverName);
        hideCreateServerModal();
        alert(`Server "${serverName}" erstellt! üéâ`);

      } catch (error) {
        console.error("Error creating server:", error);
        alert("Fehler beim Erstellen des Servers: " + error.message);
      }
    }

    // Create Channel
    window.createChannel = async function() {
      const channelName = document.getElementById('channelNameInput').value;
      if (!channelName) {
        alert("Gib einen Channel-Namen ein!");
        return;
      }

      const user = auth.currentUser;
      if (!user) return;

      try {
        const channelId = channelName.toLowerCase().replace(/\s+/g, '-');
        const channelRef = ref(db, `servers/${currentServer}/channels/${channelId}`);
        
        await set(channelRef, {
          name: channelName,
          createdBy: user.uid,
          createdAt: new Date().toISOString()
        });

        // Add channel to UI
        const channelsList = document.getElementById('channelsList');
        const channelItem = document.createElement('li');
        channelItem.className = 'channel-item';
        channelItem.innerHTML = `# ${channelName}`;
        channelItem.onclick = () => selectChannel(channelId);
        channelsList.appendChild(channelItem);

        hideCreateChannelModal();
        alert(`Channel "${channelName}" erstellt! üéâ`);

      } catch (error) {
        console.error("Error creating channel:", error);
        alert("Fehler beim Erstellen des Channels: " + error.message);
      }
    }

    // Add Friend
    window.addFriend = async function() {
      const friendUsername = document.getElementById('friendUsernameInput').value.toLowerCase();
      if (!friendUsername) {
        alert("Gib einen Username ein!");
        return;
      }

      const user = auth.currentUser;
      if (!user) return;

      try {
        // Check if username exists
        const usernameRef = ref(db, 'usernames/' + friendUsername);
        const usernameSnapshot = await get(usernameRef);
        
        if (!usernameSnapshot.exists()) {
          alert("User mit diesem Username existiert nicht! ‚ùå");
          return;
        }

        const friendId = usernameSnapshot.val();
        
        // Check if not adding yourself
        if (friendId === user.uid) {
          alert("Du kannst nicht dich selbst als Freund hinzuf√ºgen! üôÑ");
          return;
        }

        // Check if already friends
        const friendCheckRef = ref(db, `friends/${user.uid}/${friendId}`);
        const friendCheckSnapshot = await get(friendCheckRef);
        
        if (friendCheckSnapshot.exists()) {
          alert("Dieser User ist bereits dein Freund! ‚úÖ");
          return;
        }

        // Add friend
        await set(friendCheckRef, {
          addedAt: new Date().toISOString()
        });

        hideAddFriendModal();
        alert("Freund hinzugef√ºgt! üéâ");

      } catch (error) {
        console.error("Error adding friend:", error);
        alert("Fehler beim Hinzuf√ºgen des Freundes: " + error.message);
      }
    }

    // Load Servers
    function loadServers() {
      const serversRef = ref(db, 'servers');
      const serversSidebar = document.getElementById('serversSidebar');

      onValue(serversRef, (snapshot) => {
        const data = snapshot.val();
        servers = data || {};

        // Clear existing servers (keep global, dms and add button)
        const existingServers = serversSidebar.querySelectorAll('.server-icon:not(.add-server):not(.dm)');
        existingServers.forEach(server => {
          if (!server.onclick || (!server.onclick.toString().includes('global') && !server.onclick.toString().includes('dms'))) {
            server.remove();
          }
        });

        // Add servers to UI
        Object.keys(servers).forEach(serverId => {
          addServerToUI(serverId, servers[serverId].name);
        });
      });
    }

    function addServerToUI(serverId, serverName) {
      const serversSidebar = document.getElementById('serversSidebar');
      const serverIcon = document.createElement('div');
      serverIcon.className = 'server-icon';
      if (servers[serverId]?.boosts > 0) {
        serverIcon.classList.add('boosted');
      }
      serverIcon.textContent = serverName.charAt(0).toUpperCase();
      serverIcon.onclick = () => selectServer(serverId);
      
      // Insert before the add server button
      const addServerBtn = serversSidebar.querySelector('.add-server');
      serversSidebar.insertBefore(serverIcon, addServerBtn);
    }

    // Load Friends
    function loadFriends() {
      const user = auth.currentUser;
      if (!user) return;

      const friendsRef = ref(db, 'friends/' + user.uid);
      onValue(friendsRef, async (snapshot) => {
        const data = snapshot.val();
        const friendsList = document.getElementById('friendsList');
        friendsList.innerHTML = '';
        friends = {};

        if (data) {
          // Get friend details
          const friendPromises = Object.keys(data).map(async (friendId) => {
            const friendRef = ref(db, 'users/' + friendId);
            const friendSnapshot = await get(friendRef);
            if (friendSnapshot.exists()) {
              const friendData = friendSnapshot.val();
              friends[friendId] = friendData;
              
              const friendItem = document.createElement('div');
              friendItem.className = 'friend-item';
              friendItem.innerHTML = `
                <div class="friend-avatar">${friendData.avatar}</div>
                <span>${friendData.username}</span>
              `;
              friendItem.onclick = () => startDM(friendId);
              friendsList.appendChild(friendItem);
            }
            return null;
          });

          await Promise.all(friendPromises);
        } else {
          const noFriends = document.createElement('div');
          noFriends.className = 'friend-item';
          noFriends.textContent = "Noch keine Freunde üò¢";
          noFriends.style.color = '#888';
          friendsList.appendChild(noFriends);
        }
      });
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    }

    // Check for invite links on page load
    window.addEventListener('load', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const inviteServer = urlParams.get('invite');
      const inviteCode = urlParams.get('code');
      
      if (inviteServer && inviteCode) {
        alert(`üéâ Du wurdest zu Server ${inviteServer} eingeladen!\n\nEinladungscode: ${inviteCode}\n\n(Server Beitritt Funktion kommt bald!)`);
      }
    });

    // Initialize default channels for global server
    function initializeGlobalServer() {
      const globalServerRef = ref(db, 'servers/global');
      get(globalServerRef).then((snapshot) => {
        if (!snapshot.exists()) {
          set(globalServerRef, {
            name: 'Global Server',
            owner: 'system',
            createdAt: new Date().toISOString(),
            channels: {
              willkommen: {
                name: "üéâ Willkommen",
                createdBy: 'system'
              },
              general: {
                name: "üí¨ Allgemein", 
                createdBy: 'system'
              },
              games: {
                name: "üéÆ Gaming",
                createdBy: 'system'
              },
              music: {
                name: "üéµ Musik",
                createdBy: 'system'
              }
            }
          });
        }
      });
    }

    // Initialize on load
    initializeGlobalServer();
  </script>
</body>
</html>
